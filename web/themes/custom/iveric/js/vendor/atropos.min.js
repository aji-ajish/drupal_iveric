(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self,t.Atropos=e())})(this,function(){"use strict";function t(){return t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a])}return t},t.apply(this,arguments)}function e(e){void 0===e&&(e={});var r,i,s,c,u,p,f,l,d,v,h,m=e,y=m.el,g=m.eventsEl,M={__atropos__:!0,params:t({alwaysActive:!1,activeOffset:50,shadowOffset:50,shadowScale:1,duration:300,rotate:!0,rotateTouch:!0,rotateXMax:15,rotateYMax:15,rotateXInvert:!1,rotateYInvert:!1,stretchX:0,stretchY:0,stretchZ:0,commonOrigin:!0,shadow:!0,highlight:!0,onEnter:null,onLeave:null,onRotate:null},n(e||{})),destroyed:!1,isActive:!1},x=M.params,w=[],O=function t(){h=requestAnimationFrame(function(){w.forEach(function(t){if("function"==typeof t)t();else{var e=t.element,o=t.prop,a=t.value;e.style[o]=a}}),w.splice(0,w.length),t()})};O();var b=function(t,e){w.push({element:t,prop:"transitionDuration",value:e})},T=function(t,e){w.push({element:t,prop:"transitionTimingFunction",value:e})},X=function(t,e){w.push({element:t,prop:"transform",value:e})},Y=function(t,e){w.push({element:t,prop:"opacity",value:e})},_=function(t,e){w.push({element:t,prop:"transformOrigin",value:e})},L=function(t,e,o,a){return t.addEventListener(e,o,a)},A=function(t,e,o,a){return t.removeEventListener(e,o,a)},E=function(){var t;p=o(y,".atropos-shadow"),p||(p=document.createElement("span"),p.classList.add("atropos-shadow"),t=!0),X(p,"translate3d(0,0,-"+x.shadowOffset+"px) scale("+x.shadowScale+")"),t&&r.appendChild(p)},R=function(){var t;f=o(y,".atropos-highlight"),f||(f=document.createElement("span"),f.classList.add("atropos-highlight"),t=!0),X(f,"translate3d(0,0,0)"),t&&s.appendChild(f)},I=function(t){var e=t.rotateXPercentage,o=void 0===e?0:e,n=t.rotateYPercentage,r=void 0===n?0:n,i=t.duration,s=t.opacityOnly,c=t.easeOut,u=function(t){if(t.dataset.atroposOpacity&&"string"==typeof t.dataset.atroposOpacity)return t.dataset.atroposOpacity.split(";").map(function(t){return parseFloat(t)})};a(y,"[data-atropos-offset], [data-atropos-opacity]").forEach(function(t){b(t,i),T(t,c?"ease-out":"");var e=u(t);if(0===o&&0===r)s||X(t,"translate3d(0, 0, 0)"),e&&Y(t,e[0]);else{var a=parseFloat(t.dataset.atroposOffset)/100;if(Number.isNaN(a)||s||X(t,"translate3d("+-r*-a+"%, "+o*-a+"%, 0)"),e){var n=e[0],p=e[1],f=Math.max(Math.abs(o),Math.abs(r));Y(t,n+(p-n)*f/100)}}})},P=function(t,e){var o=y!==g;if(c||(c=y.getBoundingClientRect()),o&&!u&&(u=g.getBoundingClientRect()),void 0===t&&void 0===e){var a=o?u:c;t=a.left+a.width/2,e=a.top+a.height/2}var n,i=0,s=0,p=c,l=p.top,d=p.left,v=p.width,h=p.height;if(o){var m=u,M=m.top,w=m.left,O=m.width,L=m.height,A=d-w,E=l-M,R=v/2+A,P=h/2+E,j=t-w,D=e-M;s=x.rotateYMax*(j-R)/(O-v/2)*-1,i=x.rotateXMax*(D-P)/(L-h/2),n=t-d+"px "+(e-l)+"px"}else{var F=v/2,C=h/2,S=t-d,k=e-l;s=x.rotateYMax*(S-F)/(v/2)*-1,i=x.rotateXMax*(k-C)/(h/2)}i=Math.min(Math.max(-i,-x.rotateXMax),x.rotateXMax),x.rotateXInvert&&(i=-i),s=Math.min(Math.max(-s,-x.rotateYMax),x.rotateYMax),x.rotateYInvert&&(s=-s);var q=i/x.rotateXMax*100,N=s/x.rotateYMax*100,B=(o?N/100*x.stretchX:0)*(x.rotateYInvert?-1:1),Z=(o?q/100*x.stretchY:0)*(x.rotateXInvert?-1:1),z=o?Math.max(Math.abs(q),Math.abs(N))/100*x.stretchZ:0;X(r,"translate3d("+B+"%, "+-Z+"%, "+-z+"px) rotateX("+i+"deg) rotateY("+s+"deg)"),n&&x.commonOrigin&&_(r,n),f&&(b(f,x.duration+"ms"),T(f,"ease-out"),X(f,"translate3d("+.25*-N+"%, "+.25*q+"%, 0)"),Y(f,Math.max(Math.abs(q),Math.abs(N))/100)),I({rotateXPercentage:q,rotateYPercentage:N,duration:x.duration+"ms",easeOut:!0}),"function"==typeof x.onRotate&&x.onRotate(i,s)},j=function(){w.push(function(){return y.classList.add("atropos-active")}),b(r,x.duration+"ms"),T(r,"ease-out"),X(i,"translate3d(0,0, "+x.activeOffset+"px)"),b(i,x.duration+"ms"),T(i,"ease-out"),p&&(b(p,x.duration+"ms"),T(p,"ease-out")),M.isActive=!0},D=function(t){if(l=void 0,!("pointerdown"===t.type&&"mouse"===t.pointerType||"pointerenter"===t.type&&"mouse"!==t.pointerType)){if("pointerdown"===t.type&&t.preventDefault(),d=t.clientX,v=t.clientY,x.alwaysActive)return c=void 0,void(u=void 0);j(),"function"==typeof x.onEnter&&x.onEnter()}},F=function(t){!1===l&&t.cancelable&&t.preventDefault()},C=function(t){if(x.rotate&&M.isActive){if("mouse"!==t.pointerType){if(!x.rotateTouch)return;t.preventDefault()}var e=t.clientX,o=t.clientY,a=e-d,n=o-v;if("string"==typeof x.rotateTouch&&(0!==a||0!==n)&&void 0===l){if(a*a+n*n>=25){var r=180*Math.atan2(Math.abs(n),Math.abs(a))/Math.PI;l="scroll-y"===x.rotateTouch?r>45:90-r>45}!1===l&&(y.classList.add("atropos-rotate-touch"),t.cancelable&&t.preventDefault())}"mouse"!==t.pointerType&&l||P(e,o)}},S=function(t){if(c=void 0,u=void 0,M.isActive&&!(t&&"pointerup"===t.type&&"mouse"===t.pointerType||t&&"pointerleave"===t.type&&"mouse"!==t.pointerType)){if("string"==typeof x.rotateTouch&&l&&y.classList.remove("atropos-rotate-touch"),x.alwaysActive)return P(),"function"==typeof x.onRotate&&x.onRotate(0,0),void("function"==typeof x.onLeave&&x.onLeave());w.push(function(){return y.classList.remove("atropos-active")}),b(i,x.duration+"ms"),T(i,""),X(i,"translate3d(0,0, 0px)"),p&&(b(p,x.duration+"ms"),T(p,"")),f&&(b(f,x.duration+"ms"),T(f,""),X(f,"translate3d(0, 0, 0)"),Y(f,0)),b(r,x.duration+"ms"),T(r,""),X(r,"translate3d(0,0,0) rotateX(0deg) rotateY(0deg)"),I({duration:x.duration+"ms"}),M.isActive=!1,"function"==typeof x.onRotate&&x.onRotate(0,0),"function"==typeof x.onLeave&&x.onLeave()}},k=function(t){var e=t.target;!g.contains(e)&&e!==g&&M.isActive&&S()},q=function(){"string"==typeof y&&(y=o(document,y)),y&&(y.__atropos__||(void 0!==g?"string"==typeof g&&(g=o(document,g)):g=y,Object.assign(M,{el:y}),r=o(y,".atropos-rotate"),i=o(y,".atropos-scale"),s=o(y,".atropos-inner"),y.__atropos__=M))},N=function(){q(),y&&g&&(x.shadow&&E(),x.highlight&&R(),x.rotateTouch&&("string"==typeof x.rotateTouch?y.classList.add("atropos-rotate-touch-"+x.rotateTouch):y.classList.add("atropos-rotate-touch")),o(y,"[data-atropos-opacity]")&&I({opacityOnly:!0}),L(document,"click",k),L(g,"pointerdown",D),L(g,"pointerenter",D),L(g,"pointermove",C),L(g,"touchmove",F),L(g,"pointerleave",S),L(g,"pointerup",S),L(g,"lostpointercapture",S),x.alwaysActive&&(j(),P()))},B=function(){M.destroyed=!0,cancelAnimationFrame(h),A(document,"click",k),A(g,"pointerdown",D),A(g,"pointerenter",D),A(g,"pointermove",C),A(g,"touchmove",F),A(g,"pointerleave",S),A(g,"pointerup",S),A(g,"lostpointercapture",S),delete y.__atropos__};return M.destroy=B,N(),M}var o=function(t,e){return t.querySelector(e)},a=function(t,e){return t.querySelectorAll(e)},n=function(t){void 0===t&&(t={});var e={};return Object.keys(t).forEach(function(o){void 0!==t[o]&&(e[o]=t[o])}),e};return e});